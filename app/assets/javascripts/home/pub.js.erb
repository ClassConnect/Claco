$(document).ready(function() {

	$.ajax({
		url : "http://api.tumblr.com/v2/blog/blog.claco.com/posts/text?api_key=eXygZaU3C4eh2cJeaiMem4E44J4HtRaNqkuwPTutBjo9wVInHc&limit=1",
		dataType : "jsonp",
		timeout : 10000,
		success: function(retData) {
			$(".blogt").hide().text(retData['response']['posts'][0]['title']).fadeIn(500);
			$(".blogtext").hide().text(retData['response']['posts'][0]['body'].replace(/<(?:.|\n)*?>/gm, '').substring(0, 410) + "...").fadeIn(500);
		}
	});

	$('a#forgot_link').one('click', function /* prefillForgotPage */ (e){
		e.preventDefault();
		var username = $(this).parent().find('input#user-info').val() || $('input#user-info').val();
		var link = $(this).attr('href');
		$('a#forgot_link').attr('href', link+'?user='+username);
		// $('a#forgot_link').click();
		window.location = $('a#forgot_link').attr('href');
	});


	$('.nominate-btn').click(function() {
		jQuery.facebox($('#nominate-form'));

		$("#facebox .firstfocus").focus();

		// set the form handler
		$('#facebox .bodcon').submit(function() {
		});
	});

	$(document).bind('reveal.facebox', function() {
		fieldAdder();
	});

});


function fieldAdder() {
  $('#facebox input.invite_').last()
  	.css('opacity', 0.4);

	$('#facebox input.invite_').last()
		.on('focus',
		  function () {
				if($('#facebox input.invite_').last().prev().val() != '') {
				  $('#facebox .buttonbar').first()
		      .before('<input name="invite[]" maxlength="50" class="invite_" style="margin-top:0px; width:300px" type="email" placeholder="Enter an awesome teacher\'s email!" value=""/>');
			  }
			  $('#facebox input.invite_').off('focus');
			  $('#facebox input.invite_').css('opacity', 1);
				fieldAdder();
		  });
}
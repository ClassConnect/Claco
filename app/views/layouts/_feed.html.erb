
<% 
# this layout view is pretty disgusting, but the block variable's scope is limited to here, so the entirety of the content is stuck in this file 
%>
<div class="whitebox">

	<div style="margin-top:-15px"></div>
	
	<% @subsfeed.each do |f| 

		f = f.size==1 ? f.first : { :model=>f.first[:model], :owner=>f.first[:owner], :log=>f.first[:log], :array=>f } 

		@f = f

		%>

		<div class="newsitem">
			<div class="imgarea">
				<a href="<%= "/#{f[:owner].username}" %>">
					<img src="<%= teacher_thumb_md(f[:owner]) %>" >
				</a>
			</div>
			<% 
			case f[:log]['method'].to_s 
			when "createfile" %>

				<div class="feedcontent">

					<%= render 'layouts/feedpieces/createfileheader' %>

					<%= render 'layouts/feedpieces/feedcontent' %>

				</div>

			<% when "createcontent" %>

				<div class="feedcontent">

					<%= render 'layouts/feedpieces/createcontentheader' %>

					<%= render 'layouts/feedpieces/feedcontent' %>

				</div>

			<% when "update" %>

				<div class="feedcontent">
					
					<%= render 'layouts/feedpieces/updateheader' %>

					<%= render 'layouts/feedpieces/feedcontent' if !f[:array] %>

				</div>

			<% when "forkitem" %>

				<div class="feedcontent">

					<%= render 'layouts/feedpieces/forkitemheader' %>

					<%= render 'layouts/feedpieces/feedcontent' %>

				</div>

			<% when "favorite" %>

				<div class="feedcontent">

					<%= render 'layouts/feedpieces/favoriteheader' %>

					<%= render 'layouts/feedpieces/feedcontent' %>

				</div>

			<% when "setpub" %>

				<div class="feedcontent">

					<%= render 'layouts/feedpieces/setpubheader' %>

					<%= render 'layouts/feedpieces/feedcontent' %>

				</div>

			<% when 'sub' %>

				<% @subscribee = Teacher.where(:username => /^#{Regexp.escape(f[:log].params['username'].to_s)}$/i).first %>

				<div class="feedcontent">

					<%= render 'layouts/feedpieces/subheader' %>

					<%= render 'layouts/feedpieces/feedsub' %>

				</div>

			<% end %>
			<div style="clear:both"></div>
		</div>
		<% if !f[:log][:full].nil? %>
			<div class="newsitem">
				<div class="imgarea">
					<a href="#"></a>
				</div>
				<div class="feedcontent">
					<div class="thetitle">
						<a href="<%= "/#{f[:owner].username}" %>">See more from <%= f[:owner].username %></a>
					</div>
				</div>
				<div style="clear:both"></div>
			</div>
		<% end %>
	<% end %>
</div>

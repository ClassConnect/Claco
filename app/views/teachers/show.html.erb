<% content_for :headcon do %>
  <%= javascript_include_tag "profile/main" %>
  <%= stylesheet_link_tag "teacher", :media => "all" %>
  <%= javascript_include_tag "home/main" %>
  <%= stylesheet_link_tag    "home/main", :media => "all" %>
<% end %>

<div class="container">
  <div class="profile-avatar-wrap">
    <img src="<%= @teacher.info.avatar.thumb_lg.url %>">
    <% #<span class="clips">
      #<strong>4,204</strong> snaps
    #</span>
    %>
  </div>
</div>

<div class="profile-header-bar clearfix">
  <div class="container clearfix">
    <div class="profile-header-bar-push">
      <h2 class="pull-left"><strong><%= @teacher.full_name %></strong> (<%= @teacher.username %>)</h2>
      <div class="pull-right">
        <% if !@is_self %>

        <% if !current_teacher.subscribed_to?(@teacher.id) %>
        <a id="subbtn" class="btn btn-medium btn-primary actbtn">
          <%= image_tag("profile/whitescribe.png", :style => "float:left;height:12px;margin:3px 5px 0 0") %>
          <span class="upme">Subscribe</span>
        </a>
        <% else %>
        <a id="subbtn" class="btn btn-medium btn-danger actbtn">
          <%= image_tag("profile/whitescribe.png", :style => "float:left;height:12px;margin:3px 5px 0 0") %>
          <span class="upme">Unsubscribe</span>
        </a>
        <% end %>

        <% if false %>
        <% if current_teacher.colleague_status(@teacher.id) == 0 %>
        <a id="collbtn" class="btn btn-medium">
          <%= image_tag("profile/colleague.png", :style => "float:left;height:16px;margin:1px 5px 0 0") %>
          <span class="upme">Add Colleague</span>
        </a>
        <% else %>
        <a id="collbtn" class="btn btn-medium" disabled>
          <%= image_tag("profile/colleague.png", :style => "float:left;height:16px;margin:1px 5px 0 0") %>
          <span class="upme">Request Sent</span>
        </a>
        <% end %>
        <% end %>

        <!--
        <a id="messbtn" class="btn btn-medium">
          <%= image_tag("profile/message.png", :style => "float:left;height:14px;margin:2px 5px 0 0") %>
          Message
        </a>
        -->
      <% else %>

        <a href="/editinfo" class="btn btn-medium actbtn">
          <span class="upme">Edit Info</span>
        </a>

      <% end %>
      </div>
    </div>
  </div>
</div>

<div class="profile-info-section">
  <div class="container">
    <div class="pull-left profile-left-push">
      <p>
        <%= @teacher.info.bio %>
      </p>
      <ul class="profile-info-items">
        <% if !@teacher.info.twitterhandle.empty? %>
        <li>
          <a href="<%= @teacher.info.twitterhandle %>" target="_blank">
            <span class="twitterIcon"><%= image_tag("settings/twitter.png", :style => "margin-top:-4px") %></span>
            <%= URI.parse(@teacher.info.twitterhandle).path.split('/').last %>
          </a>
        </li>
        <% end %>
        <% if !@teacher.info.website.empty? %>
        <li>
          <a href="<%= @teacher.info.website %>" target="_blank">
            <span class="webIcon"><%= image_tag("settings/website.png", :style => "margin-top:-4px") %></span>
            <%= URI.parse(@teacher.info.website).host.sub(/www\./, "") %>
          </a>
        </li>
        <% end %>
        <% if @teacher.info.fulllocation != ", , " %>
        <li>
          <span class="locationIcon"><%= image_tag("profile/point.png", :style => "margin-top:-4px") %></span>
          Lives in <%= @teacher.info.fulllocation %>
          </span>
        </li>
        <% end %>
      </ul>
    </div>
    <div class="pull-right profile-module">
      <h3>
        <strong><%= @subscriptions.count %></strong>
        Subscriptions 
      </h3>
      <ul class="profile-avatars">
        <% @subscriptions.each do |sub| %>
          <li>
            <a href="/<%= sub.username %>">
              <img src="<%= sub.info.avatar.thumb_md.url %>">
            </a>
          </li>
        <% end %>
      </ul>
    </div>
    <div class="pull-right profile-module">
      <h3>
        <strong><%= @subscribers.count %></strong>
        Subscribers 
      </h3>
      <ul class="profile-avatars">
        <% @subscribers.each do |sub| %>
          <li>
            <a href="/<%= sub.username %>">
              <img src="<%= sub.info.avatar.thumb_md.url %>">
            </a>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>

<div class="container">
  <ul class="nav-tabs onProfile">
    <li class="active">
      <a href="#binders">
        Portfolio
      </a>
    </li>
    <li>
      <a href="#activity">
        Activity 
      </a>
    </li>
  </ul>
</div>

<div class="container profile-content">
  <!--Feed goes here, lulz-->
<% #if @binder_create.any? 
%>
	<% #@binder_create.each do |f| 
	%>
		<%= #f.inspect.to_s 
		%>

    <div id="binders" class="tabswap">
    <%= render 'layouts/binderlist' 
    %>
    <%= #render 'layouts/contentlist' 
    %>
    </div>

	<% #end 
	%>
<% #end 
%>
<div id="activity" class="tabswap feedwrap" style="display:none">

  <%= render 'layouts/feed' %>

<% if false %>
  <% @feed.each do |f| %>
  	<%= f[:owner].fname.to_s %>&nbsp;
  	<%= f[:owner].lname.to_s %>&nbsp;,&nbsp;
  	<%= f[:binder].title.to_s %>&nbsp;,&nbsp;
  	<%= f[:log].method.to_s %>&nbsp;,&nbsp;
  	<%= #Time.at(f[:log].timestamp).to_datetime 
  	%><%= time_ago_in_words(Time.at(f[:log].timestamp).to_datetime) %> ago
  	<br />
  <% end %>
<% end %>

</div>
</div>

<% if false %>
        <h1>Profile Page</h1>
        <p>app/views/teachers/show.html.erb</p>

        <p><%= "#{ @teacher.full_name }" %></p>
        <p><%=  #!@teacher.info.avatar.path.to_s.empty? ? image_tag(@teacher.info.avatar, :width => "200") : "<no profile picture>" 
        %></p>

        <img src="<%=	@teacher.info.avatar.url.to_s %>" />
        <img src="<%= @teacher.info.avatar.thumb_lg.to_s %>" />
        <img src="<%= @teacher.info.avatar.thumb_sm.to_s %>" />

        <% if !@teacher.info.nil? %>
        <p><%= "Bio: #{@teacher.info.bio}" if !@teacher.info.bio.empty? %></p>
        <p><%= "Website: #{@teacher.info.website}" if !@teacher.info.website.empty? %></p>
        <% end %>

        <%= link_to "Edit Info", "/editinfo" if current_teacher.id == @teacher.id %>

        <% if current_teacher.id != @teacher.id %>
            <%= form_for @relationship, :url => get_subscription_path() do |f| %>
                <%= get_subscription_button(f) %>
            <% end %>
            <%= form_for @relationship, :url => get_colleague_path() do |f| %>
                <%= get_colleague_button(f) %>
            <% end %>
        <% else %>
            <% if @colleague_requests.any? %>
                <p>You have pending colleague requests!</p>
                <% @colleague_requests.each do |request| %>
                    <%= form_for request, :url => confadd_path(request.user_id) do |f| %>
                        <%= f.submit "Accept colleague request from #{Teacher.find(request.user_id).full_name}", :confirm => "Are you absofuckinlutely positve?" %>
                    <% end %>
                <% end %>
            <% end %>
            <% if @colleagues.any? %>
                <hr />
                <p>You are colleagues with the following teachers:</p>
                <table>
                    <tr>
                        <td colspan = "2">
                            <hr />
                        </td>
                    </tr>
                    <% @colleagues.each do |colleague| %>
                    <tr>
                        <td>
                            <%= # deprecated
                            get_teacher_avatar(colleague, {:height => 60, :border => 1}) %>
                        </td>
                        <td>
                            <p>
                                <%= "#{colleague.full_name} " %>
                                <%= link_to colleague.email, colleague %>
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td colspan = "2">
                            <hr />
                        </td>
                    </tr>
                    <% end %>
                    </tr>
                </table>
            <% end %>
            <br />
            <% if @subscriptions.any? %>
                <hr />
                <p>You are subscribed to the following teachers:</p>
                <table>
                    <tr>
                        <td colspan = "2">
                            <hr />
                        </td>
                    </tr>
                    <% @subscriptions.each do |subscription| %>
                    <tr>
                        <td>
                            <%= get_teacher_avatar(subscription, {:height => 60, :border => 1}) %>
                        </td>
                        <td>
                            <p>
                                <%= "#{subscription.full_name}: " %>
                                <%= link_to subscription.email, subscription %>
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td colspan = "2">
                            <hr />
                        </td>
                    </tr>
                    <% end %>
                </table>
            <% end %>
        <% end %>
        <% if @owned_root_binders.any? %>

        <br />
        <hr />
            <p><%= "#{ @teacher.full_name }'s binders:" %></p>
            <p>[Home]</p>
            <br />
            <% @owned_root_binders.each do |root_binder| %>
                &nbsp;&nbsp;&nbsp;[<%= link_to "#{root_binder.title}", "/teachers/#{params[:id]}/binder/#{root_binder.id}" %>]
                <br />
            <% end %>
        <% end %>
<% end %>
